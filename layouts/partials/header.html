{{ "<!-- navigation -->" | safeHTML }}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const notice = document.querySelector('.notice');
    if (notice) {
      document.body.classList.add('has-notice');
    }
  });
</script>
<header class="navigation">
  <div class="container wrap">
    <div class="logo">
      <a href='{{ if eq .Site.Language.Lang "en" }}{{ site.BaseURL }}{{ else }}{{ site.BaseURL }}{{ .Site.Language.Lang }}{{end}}'
        title="{{ site.Title }}" style="border-bottom: 0px solid #e0e0e0;">
        <img loading="eager" decoding="async" fetchpriority="high" width="{{ site.Params.logo_width}}" class="img-fluid"
          src="{{ site.Params.logo | absURL }}" alt="{{ site.Title }}">
      </a>
    </div>

    <nav class="main-menu">
      <ul class="main-menu__wrapper">
        {{ range site.Menus.main }}
        {{ if .HasChildren }}
        <li class="menu-item-has-children">
          <a href="#" style="border-bottom: 0px solid #e0e0e0;"><span>{{ .Name }}</span></a>
          <div class="sub-menu">
            <div class="col-container">
              <div class="col1">
                <ul class="menu">
                  <li class="menu-title">Main</li>
                  {{ range first 5 .Children }}
                  <li class="menu-item">
                    <a href="{{ .URL | absURL }}" {{ with .Pre }} target="{{ . }}" {{ end }}>
                      {{ .Name }}
                      {{ if .Post }}<span class="menu-description">{{ .Post }}</span>{{ end }}
                    </a>
                  </li>
                  {{ end }}
                </ul>
              </div>
              <div class="col2">
                <ul class="menu">
                  <li class="menu-title">Additional Information</li>
                  {{ range after 5 .Children }}
                  <li class="menu-item">
                    <a href="{{ .URL | absURL }}" {{ with .Pre }} target="{{ . }}" {{ end }}>
                      {{ .Name }}
                      {{ if .Post }}<span class="menu-description">{{ .Post }}</span>{{ end }}
                    </a>
                  </li>
                  {{ end }}
                </ul>
              </div>
              <div class="col3">
                {{ if eq .Name "About" }}
                <ul class="menu">
                  <li class="menu-title">Featured Information</li>
                </ul>
                <div class="featured-articles">
                  {{ range where site.Data.featured_articles.about "visible" true }}
                  <div class="article-card">
                    <a href="{{ .link }}" class="article-link">
                      <div class="article-image">
                        <img src="{{ .image }}" alt="{{ .title }}">
                      </div>
                      <div class="article-content">
                        <h4>{{ .title }}</h4>
                        <p>{{ .description }}</p>
                      </div>
                    </a>
                  </div>
                  {{ end }}
                  {{ else if eq .Name "Activities" }}
                  <ul class="menu">
                    <li class="menu-title">Featured Information</li>
                  </ul>
                  <div class="featured-articles">
                    {{ range where site.Data.featured_articles.activities "visible" true }}
                    <div class="article-card">
                      <a href="{{ .link }}" class="article-link">
                        <div class="article-image">
                          <img src="{{ .image }}" alt="{{ .title }}">
                        </div>
                        <div class="article-content">
                          <h4>{{ .title }}</h4>
                          <p>{{ .description }}</p>
                        </div>
                      </a>
                    </div>
                    {{ end }}
                    {{ else if eq .Name "Learning" }}
                    <ul class="menu">
                      <li class="menu-title">Featured Articles</li>
                    </ul>
                    <div class="featured-articles">
                      {{ range where site.Data.featured_articles.learning "visible" true }}
                      <div class="article-card">
                        <a href="{{ .link }}" class="article-link">
                          <div class="article-image">
                            <img src="{{ .image }}" alt="{{ .title }}">
                          </div>
                          <div class="article-content">
                            <h4>{{ .title }}</h4>
                            <p>{{ .description }}</p>
                          </div>
                        </a>
                      </div>
                      {{ end }}
                      {{ else if eq .Name "Community" }}
                      <ul class="menu">
                        <li class="menu-title">Featured Activity</li>
                      </ul>
                      <div class="featured-articles">
                        {{ $pages := where site.Pages "Type" "in" "redirects" }}
                        {{ $pages = where $pages "Section" "events" }}
                        {{ range first 1 ($pages.ByDate.Reverse) }}
                        <div class="article-card">
                          <a href="{{ .Params.redirect }}" class="article-link" target="_blank">
                            <div class="article-image">
                              <img src="{{ .Params.image }}" alt="{{ .Title }}">
                            </div>
                            <div class="article-content">
                              <h4>{{ .Title }} will be held on {{ .Date.Format "January 2, 2006" }}</h4>
                            </div>
                          </a>
                        </div>
                        {{ end }}
                        {{ range where site.Data.featured_articles.community "visible" true }}
                        <div class="article-card">
                          <a href="{{ .link }}" class="article-link">
                            <div class="article-image">
                              <img src="{{ .image }}" alt="{{ .title }}">
                            </div>
                            <div class="article-content">
                              <h4>{{ .title }}</h4>
                            </div>
                          </a>
                        </div>
                        {{ end }}
                        {{ else if eq .Name "Blog & News" }}
                        <ul class="menu">
                          <li class="menu-title">Featured Articles</li>
                        </ul>
                        <div class="featured-articles">
                          {{ range where site.Data.featured_articles.blog "visible" true }}
                          <div class="article-card">
                            <a href="{{ .link }}" class="article-link">
                              <div class="article-image">
                                <img src="{{ .image }}" alt="{{ .title }}">
                              </div>
                              <div class="article-content">
                                <h4>{{ .title }}</h4>
                              </div>
                            </a>
                          </div>
                          {{ end }}
                        </div>
                        {{ end }}
                      </div>
                    </div>
                  </div>
        </li>
        {{ else }}
        {{ if eq .Name "Schedule" }}
        <li class="menu-item-has-children">
          <a href="#" style="border-bottom: 0px solid #e0e0e0;"><span>{{ .Name }}</span></a>
          <div class="sub-menu" style="padding:0px;margin:0px;">
            <div style="width:100%;margin:0px;padding:0px;" id="calendar-container">
              <div id="calendar-loading" style="text-align:center;padding:40px;color:#666;">
                <i class="ti-reload" style="animation: spin 2s linear infinite;display:block;font-size:24px;margin-bottom:10px;"></i>
                <span>Loading...</span>
              </div>
            </div>
          </div>
        </li>
        {{else}}
        <li class="menu-item">
          <a href="{{ .URL | absURL }}" {{ with .Pre }} target="{{ . }}" {{ end }}><span>{{ .Name }}</span></a>
        </li>
        {{ end }}
        {{ end }}
        {{ end }}
      </ul>

      <div class="header-cta">
        <a href="{{ " slack" | absURL }}" class="btn btn-primary" target="_blank">
          <i class="ti-comments pr-2"></i>{{ T "join_slack" }}
        </a>
        {{ if in .CurrentSection.Permalink "/learn/learning-path"}}
        <select id="langpicker" class="selectpicker" data-style="btn-light" data-width="fit">
          <option>{{ .Site.Language.LanguageName }}</option>
          {{ range .Translations }}
          <option value="{{ .Permalink }}">{{ .Language.LanguageName }}</option>
          {{ end }}
        </select>
        {{ else }}
        <select id="langpicker" class="selectpicker" data-style="btn-light" data-width="fit">
          <option>{{ .Site.Language.LanguageName }}</option>
          {{ range where .Translations ".Language.Lang" "in" "en ja fr pt-br"}}
          <option value="{{ .Permalink }}">{{ .Language.LanguageName }}</option>
          {{ end }}
        </select>
        {{ end }}
      </div>
    </nav>

    <button class="hamburger" type="button" aria-label="Toggle Menu">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
  </div>
</header>

<style>
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const hamburger = document.querySelector('.hamburger');
    const menu = document.querySelector('.main-menu__wrapper');
    const subMenuParents = document.querySelectorAll('.menu-item-has-children > a');
    const isMobile = window.innerWidth <= 992;

    const calendarContainer = document.getElementById('calendar-container');
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.addedNodes.length > 0) {
          const loadingElement = document.getElementById('calendar-loading');
          if (loadingElement) {
            loadingElement.style.transition = 'opacity 0.5s ease-out';
            loadingElement.style.opacity = '1';
            
            setTimeout(() => {
              loadingElement.style.opacity = '0';
              setTimeout(() => {
                loadingElement.style.display = 'none';
              }, 500);
            }, 2000);
          }
        }
      });
    });

    if (calendarContainer) {
      observer.observe(calendarContainer, { childList: true, subtree: true });
    }

    // ハンバーガーメニューの開閉
    hamburger.addEventListener('click', function () {
      this.classList.toggle('is-active');
      menu.classList.toggle('is-active');
    });

    // モバイル時のサブメニュー制御
    if (isMobile) {
      subMenuParents.forEach(item => {
        item.addEventListener('click', function (e) {
          e.preventDefault();
          const parent = this.parentElement;
          const subMenu = this.nextElementSibling;

          // 他のメニューを閉じる
          subMenuParents.forEach(otherItem => {
            if (otherItem !== this) {
              otherItem.parentElement.classList.remove('is-active');
              otherItem.nextElementSibling.classList.remove('is-active');
            }
          });

          // 現在のメニューをトグル
          parent.classList.toggle('is-active');
          subMenu.classList.toggle('is-active');
        });
      });
    }

    // ウィンドウリサイズ時の処理
    window.addEventListener('resize', function () {
      const isNowMobile = window.innerWidth <= 992;
      if (isNowMobile !== isMobile) {
        location.reload();
      }
    });
  });
</script>

{{ "<!-- /navigation -->" | safeHTML }}

{{ range site.Data.news }}
{{ if .active }}
<section class='notice bg-{{ .type }}{{ if eq .type "primary" }} text-light{{ end }}'>
  <div class="container">
      <div class="col-md-12">
        {{ if .url }}
        <i class="ti-calendar mr-2"></i>
        <a href="{{ .url }}" target="_blank">{{ .content }}</a>
        {{ else }}
        {{ .content | markdownify }}
        {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
